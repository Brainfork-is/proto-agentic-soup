<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Base Search</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .search-container {
            background: #f5f5f5;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .search-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        #search-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        #search-button {
            padding: 0.75rem 1.5rem;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
        }
        
        #search-button:hover {
            background: #005c99;
        }
        
        .results {
            margin-top: 2rem;
        }
        
        .result-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: box-shadow 0.2s;
        }
        
        .result-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .result-title {
            color: #007acc;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: bold;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .result-title:hover {
            text-decoration: underline;
        }
        
        .result-description {
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .result-url {
            color: #888;
            font-size: 0.9rem;
        }
        
        .no-results {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
        }
        
        .nav {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .nav a {
            color: #007acc;
            text-decoration: none;
            margin: 0 1rem;
        }
        
        .nav a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <nav class="nav">
        <a href="/index.html">Home</a>
        <a href="/guides/rag.html">RAG Guide</a>
        <a href="/docs/vector-db.html">Vector DBs</a>
        <a href="/policies/coop.html">Cooperation</a>
    </nav>

    <h1>Knowledge Base Search</h1>
    
    <div class="search-container">
        <form class="search-form" onsubmit="performSearch(event)">
            <input 
                type="text" 
                id="search-input" 
                placeholder="Search knowledge base..." 
                required
            >
            <button type="submit" id="search-button">Search</button>
        </form>
        <div id="search-status"></div>
    </div>

    <div class="results" id="results-container">
        <!-- Search results will be populated here -->
    </div>

    <script>
        // Knowledge base content database
        const knowledgeBase = [
            {
                title: "Vector Databases",
                url: "/docs/vector-db.html",
                description: "Comprehensive guide to vector databases including PGVector, ChromaDB, and Weaviate implementations.",
                keywords: ["vector", "database", "pgvector", "chromadb", "weaviate", "embeddings", "similarity"]
            },
            {
                title: "RAG Implementation Guide", 
                url: "/guides/rag.html",
                description: "Step-by-step guide for implementing Retrieval Augmented Generation systems with chunking strategies.",
                keywords: ["rag", "retrieval", "augmented", "generation", "chunking", "embeddings", "llm"]
            },
            {
                title: "Agent Cooperation Policies",
                url: "/policies/coop.html", 
                description: "Framework for agent collaboration including reputation systems and economic models.",
                keywords: ["cooperation", "collaboration", "reputation", "economic", "agents", "trust"]
            },
            {
                title: "Knowledge Base Home",
                url: "/index.html",
                description: "Main knowledge base dashboard with agent performance metrics and navigation.",
                keywords: ["home", "dashboard", "metrics", "performance", "navigation"]
            },
            {
                title: "Web Automation Techniques",
                url: "/search.html?topic=automation", 
                description: "Browser automation fundamentals, error handling, and performance optimization strategies.",
                keywords: ["automation", "browser", "playwright", "selenium", "scraping", "performance"]
            },
            {
                title: "Task Optimization Strategies",
                url: "/search.html?topic=optimization",
                description: "Performance metrics, load balancing, and resource optimization for agent systems.",
                keywords: ["optimization", "performance", "load balancing", "metrics", "scalability"]
            },
            {
                title: "Knowledge Management Systems", 
                url: "/search.html?topic=knowledge",
                description: "Information architecture, content organization, and knowledge extraction techniques.",
                keywords: ["knowledge", "management", "information", "architecture", "extraction"]
            },
            {
                title: "Agent Collaboration Framework",
                url: "/search.html?topic=collaboration", 
                description: "Multi-agent coordination, communication protocols, and distributed task execution.",
                keywords: ["collaboration", "multi-agent", "coordination", "communication", "distributed"]
            }
        ];

        function performSearch(event) {
            event.preventDefault();
            
            const query = document.getElementById('search-input').value.toLowerCase().trim();
            const statusEl = document.getElementById('search-status');
            const resultsEl = document.getElementById('results-container');
            
            if (!query) {
                statusEl.textContent = 'Please enter a search query.';
                return;
            }
            
            statusEl.textContent = 'Searching...';
            
            // Simulate search delay for realistic behavior
            setTimeout(() => {
                const results = searchKnowledgeBase(query);
                displayResults(results, query);
                statusEl.textContent = `Found ${results.length} result${results.length !== 1 ? 's' : ''} for "${query}"`;
            }, 300);
        }

        function searchKnowledgeBase(query) {
            const queryWords = query.toLowerCase().split(' ').filter(word => word.length > 2);
            
            return knowledgeBase
                .map(item => {
                    let score = 0;
                    
                    // Title matching (highest weight)
                    if (item.title.toLowerCase().includes(query)) score += 10;
                    queryWords.forEach(word => {
                        if (item.title.toLowerCase().includes(word)) score += 5;
                    });
                    
                    // Description matching
                    if (item.description.toLowerCase().includes(query)) score += 7;
                    queryWords.forEach(word => {
                        if (item.description.toLowerCase().includes(word)) score += 3;
                    });
                    
                    // Keyword matching
                    queryWords.forEach(word => {
                        if (item.keywords.some(keyword => keyword.includes(word))) score += 2;
                    });
                    
                    return { ...item, score };
                })
                .filter(item => item.score > 0)
                .sort((a, b) => b.score - a.score);
        }

        function displayResults(results, query) {
            const container = document.getElementById('results-container');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        No results found for "${query}". Try different keywords or browse our main sections.
                    </div>
                `;
                return;
            }
            
            const resultsHtml = results.map(result => `
                <div class="result-item">
                    <a href="${result.url}" class="result-title">${result.title}</a>
                    <div class="result-description">${highlightQuery(result.description, query)}</div>
                    <div class="result-url">${window.location.origin}${result.url}</div>
                </div>
            `).join('');
            
            container.innerHTML = resultsHtml;
        }

        function highlightQuery(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<strong>$1</strong>');
        }

        // Auto-focus search input on load
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('search-input').focus();
            
            // Handle URL parameters for direct topic searches
            const urlParams = new URLSearchParams(window.location.search);
            const topic = urlParams.get('topic');
            if (topic) {
                document.getElementById('search-input').value = topic;
                performSearch({ preventDefault: () => {} });
            }
        });
    </script>
</body>
</html>